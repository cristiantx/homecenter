telegram_test_script:
  sequence:
  - action: telegram_bot.send_message
    metadata: {}
    data:
      config_entry_id: 01KEA1ZSWWVH9FKBMG8X5WA93D
      message: Hola amigos
  alias: Telegram Test Script
  description: ''
timbre_entrada_snapshot_telegram:
  alias: Timbre Entrada Snapshot Telegram
  description: Toma una foto del timbre y la envia via Telegram
  sequence:
  - variables:
      snapshot_filename: doorbell_{{ now().strftime('%Y%m%d_%H%M%S') }}.jpg
  - parallel:
    - sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 2
          milliseconds: 0
      - action: downloader.download_file
        data:
          url: http://127.0.0.1:1984/api/frame.jpeg?src=cam5_main&{{as_timestamp(now())}}
          filename: '{{ snapshot_filename }}'
          subdir: camera_snapshot
    - sequence:
      - action: camera.snapshot
        target:
          entity_id: camera.timbre_entrada
        data:
          filename: /config/www/camera_snapshot/doorbell_snapshot_1.jpg
  - action: telegram_bot.send_photo
    data:
      file: /config/www/camera_snapshot/doorbell_snapshot_1.jpg
      caption: Timbre Entrada
  - action: telegram_bot.send_photo
    data:
      file: /config/www/camera_snapshot/{{ snapshot_filename }}
      caption: Frente de Casa
  - action: telegram_bot.send_message
    data:
      config_entry_id: 01KEA1ZSWWVH9FKBMG8X5WA93D
      message: Alguien est√° en la puerta de entrada
  mode: parallel
test_alexa:
  sequence:
  - action: notify.alexa_media
    data:
      target:
      - media_player.echo_cocina
      - media_player.echo_habitacion
      data:
        type: announce
      message: Hola bebechula
alexa_announce_with_volume:
  alias: Alexa Announce with Volume Restore
  description: Announce a message on specified Alexa devices with volume control
  fields:
    target_entities:
      description: List of Alexa media player entities
      example: "['media_player.echo_cocina', 'media_player.echo_habitacion']"
      required: true
    message:
      description: Message to announce
      example: "La lavadora ha terminado"
      required: true
    scene_id:
      description: Unique scene ID for this announcement
      example: "alexa_volume_restore_lavadora"
      required: true
    sound_id:
      description: Optional Alexa sound effect to play before announcement
      example: "amzn_sfx_doorbell_01"
      required: false
  sequence:
  - action: scene.create
    data:
      scene_id: "{{ scene_id }}"
      snapshot_entities: "{{ target_entities }}"
  - action: media_player.volume_set
    data:
      volume_level: 1.0
    target:
      entity_id: "{{ target_entities }}"
  - if:
    - condition: template
      value_template: "{{ sound_id is defined and sound_id != '' }}"
    then:
    - action: media_player.play_media
      data:
        media_content_id: "{{ sound_id }}"
        media_content_type: sound
        metadata: {}
      target:
        entity_id: "{{ target_entities }}"
  - action: notify.alexa_media
    data:
      target: "{{ target_entities }}"
      data:
        type: announce
      message: "{{ message }}"
  - delay:
      seconds: 5
  - action: scene.turn_on
    target:
      entity_id: "scene.{{ scene_id }}"
